<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Meal Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            color: #374151;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #6b7280;
        }
        
        .success-message {
            background-color: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .nav-buttons {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 4px;
            display: flex;
            gap: 4px;
        }
        
        .nav-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #6b7280;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .nav-btn:hover:not(.active) {
            background: #f3f4f6;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recipe-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .recipe-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .recipe-card.selected {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .recipe-emoji {
            font-size: 2.5rem;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .recipe-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .recipe-time {
            color: #6b7280;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn-green {
            background: #10b981;
        }
        
        .btn-green:hover {
            background: #059669;
        }
        
        .btn-red {
            background: #ef4444;
            padding: 8px;
        }
        
        .btn-red:hover {
            background: #dc2626;
        }
        
        .selected-meals {
            margin-bottom: 24px;
        }
        
        .selected-meals h3 {
            margin-bottom: 12px;
        }
        
        .meal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .meal-tag {
            background: #dbeafe;
            color: #1e40af;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .shopping-category {
            margin-bottom: 24px;
            border-left: 4px solid #3b82f6;
            padding-left: 16px;
        }
        
        .shopping-category h3 {
            margin-bottom: 12px;
            text-transform: capitalize;
            font-size: 1.2rem;
        }
        
        .shopping-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .form-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .ingredient-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1.5fr auto;
            gap: 8px;
            margin-bottom: 8px;
            align-items: end;
        }
        
        .text-link {
            color: #3b82f6;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .text-link:hover {
            color: #2563eb;
        }
        
        .hidden {
            display: none;
        }
        
        .recipe-details {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .recipe-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .recipe-header h1 {
            font-size: 2rem;
            margin-bottom: 16px;
        }
        
        .recipe-meta {
            color: #6b7280;
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .ingredients-section, .instructions-section {
            margin-bottom: 32px;
        }
        
        .ingredients-section h2, .instructions-section h2 {
            margin-bottom: 16px;
            color: #1f2937;
        }
        
        .ingredients-list {
            list-style: none;
        }
        
        .ingredients-list li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .instructions-list {
            list-style: none;
        }
        
        .instructions-list li {
            display: flex;
            margin-bottom: 16px;
            gap: 12px;
        }
        
        .step-number {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #ef4444;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .recipe-card:hover .delete-btn {
            opacity: 1;
        }
        
        .pantry-section {
            margin-bottom: 24px;
        }
        
        .pantry-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .pantry-item {
            background: #dcfce7;
            color: #166534;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .no-items {
            text-align: center;
            color: #6b7280;
            padding: 40px;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .recipe-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .ingredient-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .meal-tags {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🍽️ Family Meal Planner</h1>
            <p>Plan three delicious dinners each week</p>
            <div class="success-message">
                ✓ Your data is automatically saved in your browser!
            </div>
        </header>

        <nav class="nav">
            <div class="nav-buttons">
                <button class="nav-btn active" data-view="planning">👥 Weekly Planning</button>
                <button class="nav-btn" data-view="recipes">📚 Recipe Library</button>
                <button class="nav-btn" data-view="shopping">🛒 Shopping List</button>
            </div>
        </nav>

        <main id="content">
            <!-- Content will be dynamically loaded here -->
        </main>
    </div>

    <script>
        // App State
        let currentView = 'planning';
        let recipes = [];
        let weeklyPicks = [];
        let pantryItems = ['Salt', 'Pepper', 'Cooking oil'];
        
        const categories = ['fruit & veg', 'meat', 'dairy', 'cupboard', 'bread', 'freezer'];
        
        // Sample recipes
        const initialRecipes = [
            {
                id: 1,
                name: "Chicken Fajitas",
                cookingTime: 25,
                image: "🌮",
                ingredients: [
                    { item: "Chicken breast", amount: "500g", category: "meat" },
                    { item: "Bell peppers", amount: "3", category: "fruit & veg" },
                    { item: "Onions", amount: "2", category: "fruit & veg" },
                    { item: "Tortillas", amount: "8", category: "bread" },
                    { item: "Sour cream", amount: "1 pot", category: "dairy" },
                    { item: "Cheddar cheese", amount: "200g", category: "dairy" },
                    { item: "Olive oil", amount: "2 tbsp", category: "cupboard" },
                    { item: "Paprika", amount: "1 tsp", category: "cupboard" },
                    { item: "Cumin", amount: "1 tsp", category: "cupboard" }
                ],
                instructions: [
                    "Slice chicken breast into strips and season with paprika and cumin",
                    "Heat oil in large pan over medium-high heat",
                    "Cook chicken strips for 6-8 minutes until golden",
                    "Add sliced peppers and onions, cook for 5-7 minutes",
                    "Warm tortillas in dry pan or microwave",
                    "Serve chicken and veg with tortillas, cheese, and sour cream"
                ]
            },
            {
                id: 2,
                name: "Salmon with Rice",
                cookingTime: 30,
                image: "🍚",
                ingredients: [
                    { item: "Salmon fillets", amount: "4", category: "meat" },
                    { item: "Basmati rice", amount: "300g", category: "cupboard" },
                    { item: "Broccoli", amount: "1 head", category: "fruit & veg" },
                    { item: "Lemon", amount: "1", category: "fruit & veg" },
                    { item: "Butter", amount: "50g", category: "dairy" },
                    { item: "Garlic", amount: "3 cloves", category: "fruit & veg" }
                ],
                instructions: [
                    "Start cooking rice according to package instructions",
                    "Steam broccoli for 5-6 minutes until tender",
                    "Season salmon with salt, pepper, and lemon juice",
                    "Heat butter in pan, add minced garlic",
                    "Cook salmon skin-side down for 4 minutes, then flip for 3 minutes",
                    "Serve salmon over rice with steamed broccoli"
                ]
            },
            {
                id: 3,
                name: "Vegetable Stir Fry",
                cookingTime: 20,
                image: "🥢",
                ingredients: [
                    { item: "Mixed vegetables", amount: "500g", category: "fruit & veg" },
                    { item: "Noodles", amount: "400g", category: "cupboard" },
                    { item: "Soy sauce", amount: "3 tbsp", category: "cupboard" },
                    { item: "Sesame oil", amount: "1 tbsp", category: "cupboard" },
                    { item: "Ginger", amount: "2cm piece", category: "fruit & veg" },
                    { item: "Spring onions", amount: "4", category: "fruit & veg" }
                ],
                instructions: [
                    "Cook noodles according to package instructions",
                    "Heat sesame oil in wok or large pan",
                    "Add grated ginger and stir for 30 seconds",
                    "Add vegetables and stir-fry for 5-7 minutes",
                    "Add cooked noodles and soy sauce",
                    "Toss everything together and garnish with spring onions"
                ]
            }
        ];

        // Load data from localStorage
        function loadData() {
            recipes = JSON.parse(localStorage.getItem('familyMealPlanner-recipes')) || initialRecipes;
            weeklyPicks = JSON.parse(localStorage.getItem('familyMealPlanner-weeklyPicks')) || [];
            pantryItems = JSON.parse(localStorage.getItem('familyMealPlanner-pantryItems')) || ['Salt', 'Pepper', 'Cooking oil'];
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('familyMealPlanner-recipes', JSON.stringify(recipes));
            localStorage.setItem('familyMealPlanner-weeklyPicks', JSON.stringify(weeklyPicks));
            localStorage.setItem('familyMealPlanner-pantryItems', JSON.stringify(pantryItems));
        }

        // Generate shopping list
        function generateShoppingList() {
            const consolidatedIngredients = {};
            
            weeklyPicks.forEach(recipeId => {
                const recipe = recipes.find(r => r.id === recipeId);
                if (recipe) {
                    recipe.ingredients.forEach(ingredient => {
                        const key = ingredient.item.toLowerCase();
                        if (!pantryItems.some(item => item.toLowerCase() === key)) {
                            if (consolidatedIngredients[key]) {
                                consolidatedIngredients[key] = {
                                    ...ingredient,
                                    amount: `${consolidatedIngredients[key].amount} + ${ingredient.amount}`
                                };
                            } else {
                                consolidatedIngredients[key] = { ...ingredient };
                            }
                        }
                    });
                }
            });

            const groupedList = categories.reduce((acc, category) => {
                acc[category] = Object.values(consolidatedIngredients).filter(
                    ingredient => ingredient.category === category
                );
                return acc;
            }, {});

            return groupedList;
        }

        // View functions
        function showPlanning() {
            const selectedRecipes = weeklyPicks.map(id => recipes.find(r => r.id === id)).filter(Boolean);
            
            const content = `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h2 style="margin: 0;">This Week's Meals</h2>
                        ${weeklyPicks.length > 0 ? `
                            <button class="btn" onclick="clearAllMeals()" style="background: #ef4444; font-size: 14px; padding: 8px 16px;">
                                🗑️ Clear All
                            </button>
                        ` : ''}
                    </div>
                    <p style="color: #6b7280; margin-bottom: 24px;">
                        Select as many meals as you want for the week 
                        ${weeklyPicks.length > 0 ? `(${weeklyPicks.length} selected)` : ''}
                    </p>
                    
                    ${selectedRecipes.length > 0 ? `
                        <div class="selected-meals">
                            <h3>Selected Meals:</h3>
                            <div class="meal-tags">
                                ${selectedRecipes.map(recipe => `
                                    <div class="meal-tag">
                                        <span style="font-size: 1.2rem; margin-right: 8px;">${recipe.image}</span>
                                        <div>
                                            <div style="font-weight: 600;">${recipe.name}</div>
                                            <div style="font-size: 0.8rem; opacity: 0.8;">⏱️ ${recipe.cookingTime} min</div>
                                        </div>
                    
                    <div id="import-recipe-form" class="form-section hidden">
                        <h3 style="margin-bottom: 16px;">📋 Import Recipe</h3>
                        <p style="color: #6b7280; margin-bottom: 16px; font-size: 14px;">
                            Paste any recipe (from websites, cookbooks, etc.) and it will be automatically parsed, 
                            or paste JSON from an LLM tool.
                        </p>
                        
                        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                            <button class="nav-btn" id="text-import-btn" onclick="switchImportMode('text')" style="font-size: 14px; padding: 8px 16px;">📝 Raw Text</button>
                            <button class="nav-btn" id="json-import-btn" onclick="switchImportMode('json')" style="font-size: 14px; padding: 8px 16px;">🔧 JSON Format</button>
                        </div>
                        
                        <div id="text-import-section">
                            <div class="form-group">
                                <label>Paste Recipe Text</label>
                                <textarea id="import-text" class="form-control" rows="12" placeholder="Paste your recipe here...

Example:
Spaghetti Carbonara
Serves 4, 20 minutes

Ingredients:
- 400g spaghetti
- 200g bacon or pancetta
- 3 large eggs
- 100g parmesan cheese, grated
- Black pepper
- Salt

Instructions:
1. Cook spaghetti in salted boiling water
2. Fry bacon until crispy
3. Whisk eggs with cheese and pepper
4. Drain pasta, mix with egg mixture
5. Add bacon and serve immediately"></textarea>
                            </div>
                        </div>
                        
                        <div id="json-import-section" class="hidden">
                            <div class="form-group">
                                <label>Paste JSON Recipe</label>
                                <textarea id="import-json" class="form-control" rows="12" placeholder='Paste JSON recipe here...

Example:
{
  "name": "Spaghetti Carbonara",
  "cookingTime": 20,
  "image": "🍝",
  "ingredients": [
    {"item": "Spaghetti", "amount": "400g", "category": "cupboard"},
    {"item": "Bacon", "amount": "200g", "category": "meat"},
    {"item": "Eggs", "amount": "3", "category": "dairy"}
  ],
  "instructions": [
    "Cook spaghetti in salted boiling water",
    "Fry bacon until crispy",
    "Whisk eggs with cheese and pepper"
  ]
}'></textarea>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-green" onclick="importRecipe()">🔄 Import Recipe</button>
                            <button class="btn" onclick="hideImportRecipeForm()" style="background: #6b7280;">Cancel</button>
                        </div>
                                        <button class="text-link" onclick="showRecipeCard(${recipe.id})">View Recipe</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="recipe-grid">
                        ${recipes.map(recipe => `
                            <div class="recipe-card ${weeklyPicks.includes(recipe.id) ? 'selected' : ''}" onclick="toggleWeeklyPick(${recipe.id})">
                                <div class="recipe-emoji">${recipe.image}</div>
                                <div class="recipe-name">${recipe.name}</div>
                                <div class="recipe-time">⏱️ ${recipe.cookingTime} min</div>
                                ${weeklyPicks.includes(recipe.id) ? 
                                    '<div style="color: #10b981; font-weight: 600; margin-top: 8px; display: flex; align-items: center; gap: 4px;">✓ <span>Selected</span></div>' : 
                                    '<div style="color: #6b7280; margin-top: 8px; font-size: 0.9rem;">Click to add</div>'
                                }
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('content').innerHTML = content;
        }

        function showRecipes() {
            const content = `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2>Recipe Library</h2>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn" onclick="showAddRecipeForm()">➕ Add Recipe</button>
                            <button class="btn" onclick="showImportRecipeForm()" style="background: #8b5cf6;">📋 Import Recipe</button>
                        </div>
                    </div>
                    
                    <div id="add-recipe-form" class="form-section hidden">
                        <h3 style="margin-bottom: 16px;">Add New Recipe</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Recipe Name</label>
                                <input type="text" id="recipe-name" class="form-control" placeholder="e.g. Chicken Curry">
                            </div>
                            <div class="form-group">
                                <label>Cooking Time (minutes)</label>
                                <input type="number" id="recipe-time" class="form-control" placeholder="30">
                            </div>
                            <div class="form-group">
                                <label>Emoji</label>
                                <input type="text" id="recipe-emoji" class="form-control" placeholder="🍛" value="🍽️">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Ingredients</label>
                            <div id="ingredients-container">
                                <div class="ingredient-row">
                                    <div>
                                        <input type="text" class="form-control ingredient-name" placeholder="Ingredient name">
                                    </div>
                                    <div>
                                        <input type="text" class="form-control ingredient-amount" placeholder="Amount">
                                    </div>
                                    <div>
                                        <select class="form-control ingredient-category">
                                            ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div>
                                        <button type="button" class="btn-red" onclick="removeIngredientRow(this)">✕</button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="text-link" onclick="addIngredientRow()">+ Add ingredient</button>
                        </div>
                        
                        <div class="form-group">
                            <label>Instructions</label>
                            <div id="instructions-container">
                                <textarea class="form-control instruction-step" placeholder="Step 1" rows="2" style="margin-bottom: 8px;"></textarea>
                            </div>
                            <button type="button" class="text-link" onclick="addInstructionRow()">+ Add step</button>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-green" onclick="saveRecipe()">Save Recipe</button>
                            <button class="btn" onclick="hideAddRecipeForm()" style="background: #6b7280;">Cancel</button>
                        </div>
                    </div>
                    
                    ${recipes.length > 0 ? `
                        <div class="recipe-grid">
                            ${recipes.map(recipe => `
                                <div class="recipe-card">
                                    <button class="delete-btn" onclick="deleteRecipe(${recipe.id})" title="Delete recipe">✕</button>
                                    <div class="recipe-emoji">${recipe.image}</div>
                                    <div class="recipe-name">${recipe.name}</div>
                                    <div class="recipe-time">⏱️ ${recipe.cookingTime} min</div>
                                    <div style="color: #6b7280; font-size: 0.9rem; margin: 8px 0;">${recipe.ingredients.length} ingredients</div>
                                    <button class="btn" onclick="showRecipeCard(${recipe.id})" style="width: 100%; margin-top: 8px;">View Recipe</button>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<div class="no-items">No recipes yet. Add your first recipe above!</div>'}
                </div>
            `;
            
            document.getElementById('content').innerHTML = content;
        }

        function showShopping() {
            const shoppingList = generateShoppingList();
            const selectedRecipes = weeklyPicks.map(id => recipes.find(r => r.id === id)).filter(Boolean);
            
            const content = `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2>Shopping List</h2>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn" onclick="copyShoppingList()">📋 Copy List</button>
                            <button class="btn btn-green" onclick="window.print()">🖨️ Print</button>
                        </div>
                    </div>
                    
                    ${weeklyPicks.length === 0 ? `
                        <div class="no-items">
                            Select some meals in the Weekly Planning tab to generate a shopping list.
                        </div>
                    ` : `
                        <div class="selected-meals">
                            <h3>Selected Meals (${selectedRecipes.length}):</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px; margin-bottom: 16px;">
                                ${selectedRecipes.map(recipe => `
                                    <div class="meal-tag" style="justify-content: center; flex-direction: column; text-align: center; padding: 8px;">
                                        <span style="font-size: 1.5rem; margin-bottom: 4px;">${recipe.image}</span>
                                        <span style="font-size: 0.8rem; font-weight: 600;">${recipe.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 16px;">
                                📊 Total cooking time: ${selectedRecipes.reduce((total, recipe) => total + recipe.cookingTime, 0)} minutes
                                • Average per meal: ${Math.round(selectedRecipes.reduce((total, recipe) => total + recipe.cookingTime, 0) / selectedRecipes.length)} min
                            </div>
                        </div>
                        
                        <div class="pantry-section">
                            <h3>Pantry Items (already have):</h3>
                            <div class="pantry-items">
                                ${pantryItems.map(item => `<span class="pantry-item">${item}</span>`).join('')}
                            </div>
                            <input type="text" class="form-control" placeholder="Add pantry item (press Enter)" 
                                   style="max-width: 300px;" onkeypress="if(event.key==='Enter') addPantryItem(this)">
                        </div>
                        
                        ${Object.entries(shoppingList).map(([category, items]) => 
                            items.length > 0 ? `
                                <div class="shopping-category">
                                    <h3>${category}</h3>
                                    ${items.map(item => `
                                        <div class="shopping-item">
                                            <span>${item.item}</span>
                                            <span style="font-weight: 600; color: #3b82f6;">${item.amount}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''
                        ).join('')}
                    `}
                </div>
            `;
            
            document.getElementById('content').innerHTML = content;
        }

        function showRecipeCard(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            const content = `
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="switchView('${currentView}')" style="margin-right: 8px;">← Back to ${currentView === 'planning' ? 'Planning' : currentView === 'recipes' ? 'Recipes' : 'Shopping'}</button>
                    <button class="btn btn-green" onclick="window.print()">🖨️ Print Recipe</button>
                    <button class="btn" onclick="copyRecipeUrl(${recipeId})" style="background: #8b5cf6;">📎 Copy URL</button>
                </div>
                
                <div class="card recipe-details">
                    <div class="recipe-header">
                        <div style="font-size: 4rem; margin-bottom: 16px;">${recipe.image}</div>
                        <h1>${recipe.name}</h1>
                        <div class="recipe-meta">
                            <span>⏱️ ${recipe.cookingTime} minutes</span>
                        </div>
                    </div>
                    
                    <div class="ingredients-section">
                        <h2>Ingredients</h2>
                        <ul class="ingredients-list">
                            ${recipe.ingredients.map(ingredient => `
                                <li>
                                    <span>${ingredient.item}</span>
                                    <span style="font-weight: 600;">${ingredient.amount}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="instructions-section">
                        <h2>Instructions</h2>
                        <ol class="instructions-list">
                            ${recipe.instructions.map((instruction, index) => `
                                <li>
                                    <div class="step-number">${index + 1}</div>
                                    <div>${instruction}</div>
                                </li>
                            `).join('')}
                        </ol>
                    </div>
                </div>
            `;
            
            document.getElementById('content').innerHTML = content;
        }

        // Event handlers
        function toggleWeeklyPick(recipeId) {
            if (weeklyPicks.includes(recipeId)) {
                weeklyPicks = weeklyPicks.filter(id => id !== recipeId);
            } else {
                weeklyPicks.push(recipeId);
            }
            saveData();
            showPlanning();
        }

        function clearAllMeals() {
            if (confirm('Clear all selected meals?')) {
                weeklyPicks = [];
                saveData();
                showPlanning();
            }
        }

        function showAddRecipeForm() {
            document.getElementById('add-recipe-form').classList.remove('hidden');
        }

        function hideAddRecipeForm() {
            document.getElementById('add-recipe-form').classList.add('hidden');
            resetAddRecipeForm();
        }
        
        function resetAddRecipeForm() {
            document.getElementById('recipe-name').value = '';
            document.getElementById('recipe-time').value = '';
            document.getElementById('recipe-emoji').value = '🍽️';
            
            // Reset ingredients
            const container = document.getElementById('ingredients-container');
            container.innerHTML = `
                <div class="ingredient-row">
                    <div><input type="text" class="form-control ingredient-name" placeholder="Ingredient name"></div>
                    <div><input type="text" class="form-control ingredient-amount" placeholder="Amount"></div>
                    <div><select class="form-control ingredient-category">${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}</select></div>
                    <div><button type="button" class="btn-red" onclick="removeIngredientRow(this)">✕</button></div>
                </div>
            `;
            
            // Reset instructions
            document.getElementById('instructions-container').innerHTML = 
                '<textarea class="form-control instruction-step" placeholder="Step 1" rows="2" style="margin-bottom: 8px;"></textarea>';
        }

        function showImportRecipeForm() {
            document.getElementById('import-recipe-form').classList.remove('hidden');
            switchImportMode('text');
        }

        function hideImportRecipeForm() {
            document.getElementById('import-recipe-form').classList.add('hidden');
            document.getElementById('import-text').value = '';
            document.getElementById('import-json').value = '';
        }

        function switchImportMode(mode) {
            const textBtn = document.getElementById('text-import-btn');
            const jsonBtn = document.getElementById('json-import-btn');
            const textSection = document.getElementById('text-import-section');
            const jsonSection = document.getElementById('json-import-section');
            
            if (mode === 'text') {
                textBtn.classList.add('active');
                jsonBtn.classList.remove('active');
                textSection.classList.remove('hidden');
                jsonSection.classList.add('hidden');
            } else {
                textBtn.classList.remove('active');
                jsonBtn.classList.add('active');
                textSection.classList.add('hidden');
                jsonSection.classList.remove('hidden');
            }
        }

        function parseRecipeText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            let recipe = {
                name: '',
                cookingTime: 30,
                image: '🍽️',
                ingredients: [],
                instructions: []
            };
            
            // Try to find recipe name (usually first non-empty line)
            if (lines.length > 0) {
                recipe.name = lines[0].replace(/^\d+\.\s*/, '').trim();
            }
            
            // Try to extract cooking time
            const timeRegex = /(\d+)\s*(?:min|minute|minutes)/i;
            for (let line of lines.slice(0, 5)) { // Check first few lines
                const match = line.match(timeRegex);
                if (match) {
                    recipe.cookingTime = parseInt(match[1]);
                    break;
                }
            }
            
            // Find ingredients section
            let inIngredients = false;
            let inInstructions = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].toLowerCase();
                const originalLine = lines[i];
                
                if (line.includes('ingredient')) {
                    inIngredients = true;
                    inInstructions = false;
                    continue;
                }
                
                if (line.includes('instruction') || line.includes('method') || line.includes('direction')) {
                    inIngredients = false;
                    inInstructions = true;
                    continue;
                }
                
                if (inIngredients) {
                    const ingredient = parseIngredientLine(originalLine);
                    if (ingredient) {
                        recipe.ingredients.push(ingredient);
                    }
                } else if (inInstructions) {
                    const instruction = parseInstructionLine(originalLine);
                    if (instruction) {
                        recipe.instructions.push(instruction);
                    }
                }
            }
            
            // If no clear sections found, try to parse the whole text
            if (recipe.ingredients.length === 0) {
                for (let line of lines) {
                    if (line.match(/^[-•*]\s+/) || line.match(/^\d+(?:\.|:)?\s+\w/)) {
                        const ingredient = parseIngredientLine(line);
                        if (ingredient) {
                            recipe.ingredients.push(ingredient);
                        }
                    }
                }
            }
            
            if (recipe.instructions.length === 0) {
                for (let line of lines) {
                    if (line.match(/^\d+\.\s+/) && line.length > 10) {
                        const instruction = parseInstructionLine(line);
                        if (instruction) {
                            recipe.instructions.push(instruction);
                        }
                    }
                }
            }
            
            // Guess emoji based on recipe name
            recipe.image = guessRecipeEmoji(recipe.name);
            
            return recipe;
        }

        function parseIngredientLine(line) {
            // Remove bullet points and numbers
            const cleaned = line.replace(/^[-•*\d+\.\)\s]+/, '').trim();
            if (cleaned.length < 3) return null;
            
            // Try to extract amount and ingredient
            const match = cleaned.match(/^([\d\s\/\.\-]+(?:cups?|tbsp|tsp|g|kg|ml|l|oz|lbs?|pounds?|cloves?|pieces?|slices?|medium|large|small)?)?\s*(.+)/i);
            
            if (match) {
                const amount = match[1] ? match[1].trim() : '1';
                const item = match[2].trim();
                const category = guessIngredientCategory(item);
                
                return { item, amount, category };
            }
            
            return { item: cleaned, amount: '1', category: 'cupboard' };
        }

        function parseInstructionLine(line) {
            const cleaned = line.replace(/^\d+[\.\)\s]+/, '').trim();
            return cleaned.length > 5 ? cleaned : null;
        }

        function guessIngredientCategory(ingredient) {
            const item = ingredient.toLowerCase();
            
            if (item.includes('chicken') || item.includes('beef') || item.includes('pork') || 
                item.includes('salmon') || item.includes('fish') || item.includes('bacon') ||
                item.includes('meat') || item.includes('sausage') || item.includes('lamb')) {
                return 'meat';
            }
            
            if (item.includes('milk') || item.includes('cheese') || item.includes('cream') || 
                item.includes('butter') || item.includes('yogurt') || item.includes('egg')) {
                return 'dairy';
            }
            
            if (item.includes('onion') || item.includes('garlic') || item.includes('tomato') || 
                item.includes('pepper') || item.includes('carrot') || item.includes('potato') ||
                item.includes('lettuce') || item.includes('spinach') || item.includes('broccoli') ||
                item.includes('mushroom') || item.includes('apple') || item.includes('lemon') ||
                item.includes('vegetable') || item.includes('fruit')) {
                return 'fruit & veg';
            }
            
            if (item.includes('bread') || item.includes('tortilla') || item.includes('bun') || 
                item.includes('roll') || item.includes('bagel')) {
                return 'bread';
            }
            
            if (item.includes('frozen') || item.includes('ice cream')) {
                return 'freezer';
            }
            
            return 'cupboard';
        }

        function guessRecipeEmoji(name) {
            const n = name.toLowerCase();
            
            if (n.includes('pasta') || n.includes('spaghetti') || n.includes('noodle')) return '🍝';
            if (n.includes('pizza')) return '🍕';
            if (n.includes('burger') || n.includes('sandwich')) return '🍔';
            if (n.includes('taco') || n.includes('burrito')) return '🌮';
            if (n.includes('curry')) return '🍛';
            if (n.includes('soup')) return '🍲';
            if (n.includes('salad')) return '🥗';
            if (n.includes('chicken')) return '🍗';
            if (n.includes('fish') || n.includes('salmon')) return '🐟';
            if (n.includes('rice')) return '🍚';
            if (n.includes('stir fry')) return '🥢';
            if (n.includes('pancake')) return '🥞';
            if (n.includes('cake') || n.includes('dessert')) return '🍰';
            
            return '🍽️';
        }

        function importRecipe() {
            const textSection = document.getElementById('text-import-section');
            const isTextMode = !textSection.classList.contains('hidden');
            
            let recipe;
            
            try {
                if (isTextMode) {
                    // Parse raw text
                    const text = document.getElementById('import-text').value.trim();
                    if (!text) {
                        alert('Please paste a recipe to import');
                        return;
                    }
                    
                    recipe = parseRecipeText(text);
                    
                    if (!recipe.name) {
                        alert('Could not find recipe name. Please check the format.');
                        return;
                    }
                    
                    if (recipe.ingredients.length === 0) {
                        alert('Could not find ingredients. Please make sure they are listed clearly.');
                        return;
                    }
                    
                } else {
                    // Parse JSON
                    const jsonText = document.getElementById('import-json').value.trim();
                    if (!jsonText) {
                        alert('Please paste JSON recipe data');
                        return;
                    }
                    
                    const data = JSON.parse(jsonText);
                    
                    // Validate required fields
                    if (!data.name || !data.ingredients || !data.instructions) {
                        alert('JSON must include name, ingredients, and instructions');
                        return;
                    }
                    
                    recipe = {
                        name: data.name,
                        cookingTime: data.cookingTime || data.time || 30,
                        image: data.image || data.emoji || '🍽️',
                        ingredients: data.ingredients.map(ing => ({
                            item: ing.item || ing.ingredient || ing.name,
                            amount: ing.amount || ing.quantity || '1',
                            category: ing.category || 'cupboard'
                        })),
                        instructions: Array.isArray(data.instructions) ? data.instructions : [data.instructions]
                    };
                }
                
                // Add unique ID
                recipe.id = Date.now();
                
                // Add to recipes
                recipes.push(recipe);
                saveData();
                
                // Close form and refresh view
                hideImportRecipeForm();
                showRecipes();
                
                alert(`Successfully imported "${recipe.name}"!`);
                
            } catch (error) {
                console.error('Import error:', error);
                alert('Error importing recipe. Please check the format and try again.');
            }
        }

        function addIngredientRow() {
            const container = document.getElementById('ingredients-container');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <div><input type="text" class="form-control ingredient-name" placeholder="Ingredient name"></div>
                <div><input type="text" class="form-control ingredient-amount" placeholder="Amount"></div>
                <div><select class="form-control ingredient-category">${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}</select></div>
                <div><button type="button" class="btn-red" onclick="removeIngredientRow(this)">✕</button></div>
            `;
            container.appendChild(newRow);
        }

        function removeIngredientRow(button) {
            button.closest('.ingredient-row').remove();
        }

        function addInstructionRow() {
            const container = document.getElementById('instructions-container');
            const stepNumber = container.children.length + 1;
            const newStep = document.createElement('textarea');
            newStep.className = 'form-control instruction-step';
            newStep.placeholder = `Step ${stepNumber}`;
            newStep.rows = 2;
            newStep.style.marginBottom = '8px';
            container.appendChild(newStep);
        }

        function saveRecipe() {
            const name = document.getElementById('recipe-name').value.trim();
            const time = parseInt(document.getElementById('recipe-time').value);
            const emoji = document.getElementById('recipe-emoji').value.trim();
            
            if (!name || !time) {
                alert('Please fill in recipe name and cooking time');
                return;
            }
            
            // Get ingredients
            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            ingredientRows.forEach(row => {
                const name = row.querySelector('.ingredient-name').value.trim();
                const amount = row.querySelector('.ingredient-amount').value.trim();
                const category = row.querySelector('.ingredient-category').value;
                
                if (name && amount) {
                    ingredients.push({ item: name, amount, category });
                }
            });
            
            // Get instructions
            const instructionElements = document.querySelectorAll('.instruction-step');
            const instructions = [];
            instructionElements.forEach(element => {
                const instruction = element.value.trim();
                if (instruction) {
                    instructions.push(instruction);
                }
            });
            
            if (ingredients.length === 0 || instructions.length === 0) {
                alert('Please add at least one ingredient and one instruction');
                return;
            }
            
            // Create new recipe
            const newRecipe = {
                id: Date.now(),
                name,
                cookingTime: time,
                image: emoji,
                ingredients,
                instructions
            };
            
            recipes.push(newRecipe);
            saveData();
            hideAddRecipeForm();
            showRecipes();
        }

        function deleteRecipe(recipeId) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                recipes = recipes.filter(r => r.id !== recipeId);
                weeklyPicks = weeklyPicks.filter(id => id !== recipeId);
                saveData();
                showRecipes();
            }
        }

        function addPantryItem(input) {
            const value = input.value.trim();
            if (value && !pantryItems.includes(value)) {
                pantryItems.push(value);
                input.value = '';
                saveData();
                showShopping();
            }
        }

        function copyShoppingList() {
            const shoppingList = generateShoppingList();
            let text = "Shopping List\n\n";
            
            Object.entries(shoppingList).forEach(([category, items]) => {
                if (items.length > 0) {
                    text += `${category.toUpperCase()}\n`;
                    items.forEach(item => {
                        text += `• ${item.amount} ${item.item}\n`;
                    });
                    text += "\n";
                }
            });
            
            navigator.clipboard.writeText(text).then(() => {
                alert("Shopping list copied to clipboard!");
            });
        }

        function copyRecipeUrl(recipeId) {
            const url = `${window.location.origin}${window.location.pathname}?recipe=${recipeId}`;
            navigator.clipboard.writeText(url).then(() => {
                alert("Recipe URL copied to clipboard!");
            });
        }

        function switchView(view) {
            currentView = view;
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view === view) {
                    btn.classList.add('active');
                }
            });
            
            // Show appropriate view
            if (view === 'planning') showPlanning();
            else if (view === 'recipes') showRecipes();
            else if (view === 'shopping') showShopping();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Setup navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchView(btn.dataset.view);
                });
            });
            
            // Show initial view
            showPlanning();
        });
    </script>
</body>
</html>
